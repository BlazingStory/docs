"use strict";(globalThis.webpackChunkblazingstory_docs=globalThis.webpackChunkblazingstory_docs||[]).push([[318],{2934:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/configure-pathbase-002-folders-0e09b6d7a96cb3a68e96b223a90890a0.png"},4684:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/configure-pathbase-001-IIS-c9059afd6d5f944420b34d5d83923ed2.png"},5273:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/configure-pathbase-003-app-e4d61db5c74cb395fb23e69903b0f0aa.png"},7316:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/configure-pathbase-004-multi-apps-c79014d157f7cec7b2a1c183b09ceecc.gif"},7927:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>s,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"configure-pathbase","title":"\ud83d\uddc2\ufe0f Configure path base","description":"Blazing Story WebAssembly App","source":"@site/docs/configure-pathbase.md","sourceDirName":".","slug":"/configure-pathbase","permalink":"/docs/configure-pathbase","draft":false,"unlisted":false,"editUrl":"https://github.com/BlazingStory/docs/tree/main/docs/configure-pathbase.md","tags":[],"version":"current","frontMatter":{},"sidebar":"sidebar","previous":{"title":"\u2195\ufe0f Sorting navigation tree items","permalink":"/docs/sorting-navigation-tree-items"},"next":{"title":"\u2699\ufe0f Prefers color scheme","permalink":"/docs/prefers-color-scheme"}}');var a=t(4848),i=t(8453);const o={},s="\ud83d\uddc2\ufe0f Configure path base",p={},l=[{value:"Blazing Story WebAssembly App",id:"blazing-story-webassembly-app",level:2},{value:"Blazing Story Server App",id:"blazing-story-server-app",level:2},{value:"Deploying to subdirectories in IIS as a virtual application",id:"deploying-to-subdirectories-in-iis-as-a-virtual-application",level:3},{value:"Deploying behind a reverse proxy (nginx, etc.)",id:"deploying-behind-a-reverse-proxy-nginx-etc",level:3},{value:"Configure the reverse proxy",id:"configure-the-reverse-proxy",level:4},{value:"Configure the Blazing Story Server App",id:"configure-the-blazing-story-server-app",level:4},{value:"Changing the path base of the Blazing Story App component",id:"changing-the-path-base-of-the-blazing-story-app-component",level:3}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"\ufe0f-configure-path-base",children:"\ud83d\uddc2\ufe0f Configure path base"})}),"\n",(0,a.jsx)(n.h2,{id:"blazing-story-webassembly-app",children:"Blazing Story WebAssembly App"}),"\n",(0,a.jsxs)(n.p,{children:["To configure the path base for your Blazing Story WebAssembly App, you need to update the ",(0,a.jsx)(n.code,{children:"href"})," property of the ",(0,a.jsx)(n.code,{children:"<base />"})," element in both the ",(0,a.jsx)(n.code,{children:"wwwroot/index.html"})," and ",(0,a.jsx)(n.code,{children:"wwwroot/iframe.html"})," files. This property determines the base URL for your application."]}),"\n",(0,a.jsx)(n.p,{children:"Here's an example of how to set the path base:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-html",children:'<base href="/foo/" />\n'})}),"\n",(0,a.jsxs)(n.p,{children:["In this example, the path base is set to ",(0,a.jsx)(n.code,{children:"/foo/"}),". This means that all relative URLs in your application will be resolved against this base URL."]}),"\n",(0,a.jsx)(n.p,{children:"Make sure to adjust the path base according to your application's deployment structure."}),"\n",(0,a.jsx)(n.h2,{id:"blazing-story-server-app",children:"Blazing Story Server App"}),"\n",(0,a.jsx)(n.h3,{id:"deploying-to-subdirectories-in-iis-as-a-virtual-application",children:"Deploying to subdirectories in IIS as a virtual application"}),"\n",(0,a.jsxs)(n.p,{children:["If you are deploying your Blazing Story Server App as a virtual application in IIS, ",(0,a.jsx)(n.strong,{children:"you don't need to do anything special"})," to configure the path base. IIS and the ASP.NET Core module automatically handle the path base for virtual applications, and your application will work correctly in any subdirectory without any additional configuration. However, ensure that your application is correctly configured to run as a virtual application in IIS."]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"&quot;/foo&quot; virtual app subdirectory in IIS",src:t(4684).A+"",width:"1010",height:"615"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"&quot;/inetpub/wwwroot/foo&quot; directory on the file system",src:t(2934).A+"",width:"872",height:"429"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"The Blazor Server app running on the subpath URL, &quot;/foo&quot;",src:t(5273).A+"",width:"789",height:"417"})}),"\n",(0,a.jsx)(n.h3,{id:"deploying-behind-a-reverse-proxy-nginx-etc",children:"Deploying behind a reverse proxy (nginx, etc.)"}),"\n",(0,a.jsx)(n.p,{children:"If you want to deploy your Blazing Story Server App behind a reverse proxy (such as nginx, Apache, or others) under a subpath, you need to configure both the reverse proxy and the Blazing Story Server App."}),"\n",(0,a.jsx)(n.h4,{id:"configure-the-reverse-proxy",children:"Configure the reverse proxy"}),"\n",(0,a.jsxs)(n.p,{children:["Configure your reverse proxy to forward requests from the target subpath to the Blazing Story Server App. ",(0,a.jsx)(n.strong,{children:"The key point is to not rewrite the URL"})," when forwarding the request."]}),"\n",(0,a.jsxs)(n.p,{children:["Here's an example nginx configuration (",(0,a.jsx)(n.code,{children:"nginx.conf"}),"):"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-nginx",children:"...\nhttp {\n    ...\n    upstream blazor_backend {\n        # Specify the Blazing Story Server app running in the same host.\n        server 127.0.0.1:5000;\n    }\n\n    server {\n        listen 80;\n        server_name localhost;\n\n        # Mount Blazor app under /foo path, without URL rewriting.\n        location /foo {\n            proxy_pass http://blazor_backend;\n            ...\n        }\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h4,{id:"configure-the-blazing-story-server-app",children:"Configure the Blazing Story Server App"}),"\n",(0,a.jsxs)(n.p,{children:["On the Blazing Story Server App side, you need to configure the ",(0,a.jsx)(n.code,{children:"UsePathBase"})," middleware in the ",(0,a.jsx)(n.code,{children:"Program.cs"})," file to handle requests to the target subpath appropriately:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-cs",children:'...\napp.UseHttpsRedirection();\n\napp.UsePathBase("/foo"); // Add this line\n\napp.MapBlazingStoryMcp();\napp.MapStaticAssets();\napp.UseRouting();\napp.UseAntiforgery();\napp.MapRazorComponents<BlazingStoryServerComponent<IndexPage, IFramePage>>()\n    .AddInteractiveServerRenderMode();\n\napp.Run();\n'})}),"\n",(0,a.jsxs)(n.p,{children:["With this combination of reverse proxy configuration and ",(0,a.jsx)(n.code,{children:"UsePathBase"})," middleware, your Blazing Story Server App will work correctly under the specified subpath."]}),"\n",(0,a.jsx)(n.p,{children:"You can find a complete working example using nginx as a reverse proxy in the following GitHub repository:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://github.com/BlazingStory/samples/tree/main/pathbase/nginx",children:"https://github.com/BlazingStory/samples/tree/main/pathbase/nginx"})}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"changing-the-path-base-of-the-blazing-story-app-component",children:"Changing the path base of the Blazing Story App component"}),"\n",(0,a.jsxs)(n.p,{children:["To change the path base of the Blazing Story Server App component (not the entire application URL), you can use the ",(0,a.jsx)(n.code,{children:"IApplicationBuilder.Map(string pathMatch, Func<IApplicationBuilder> configuration)"})," method in the ",(0,a.jsx)(n.code,{children:"Program.cs"})," file of your Blazing Story Server App. Here's an example:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-cs",children:'app.Map("/stories", appBuilder =>\n{\n    appBuilder.UseRouting();\n    appBuilder.UseAntiforgery();\n    appBuilder.UseEndpoints(endpoints =>\n    {\n        endpoints.MapStaticFiles(); // If you are using .NET 8, use "appBuilder.UseStaticFiles();" instead.\n        endpoints.MapRazorComponents<BlazingStoryServerComponent<IndexPage, IFramePage>>()\n            .AddInteractiveServerRenderMode();\n    });\n});\n'})}),"\n",(0,a.jsxs)(n.p,{children:["In this example, the Blazing Story Server App component is mapped to the ",(0,a.jsx)(n.code,{children:"/stories"})," path. This means that the Blazing Story App component will be accessible at ",(0,a.jsx)(n.code,{children:"http://<your-domain>/stories"}),", while the rest of your application can still be accessed at the root URL or other paths as needed. If you add the following code after the code above, a Blazor Server App based on the ",(0,a.jsx)(n.code,{children:"DefaultApp.razor"})," application component will work under the root URL:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-cs",children:'app.UseRouting();\napp.UseAntiforgery();\n#pragma warning disable ASP0014\napp.UseEndpoints(endpoints =>\n{\n    endpoints.MapStaticFiles(); // If you are using .NET 8, use "appBuilder.UseStaticFiles();" instead.\n    endpoints.MapRazorComponents<DefaultApp>()\n        .AddInteractiveServerRenderMode();\n});\n#pragma warning restore ASP0014\n'})}),"\n",(0,a.jsx)(n.p,{children:"The result will be a single Blazing Story Server App hosting multiple Blazor Server Apps, each under different path bases. The following GIF shows an example of such an application:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:t(7316).A+"",width:"951",height:"500"})}),"\n",(0,a.jsx)(n.p,{children:"You can get the complete source code for the sample above from the following URL:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://github.com/BlazingStory/samples/tree/main/pathbase/multi-branches",children:"https://github.com/BlazingStory/samples/tree/main/pathbase/multi-branches"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>s});var r=t(6540);const a={},i=r.createContext(a);function o(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);